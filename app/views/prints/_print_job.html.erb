<% id = dynamic_object_id('print_job', f) %>
<% hide = is_dynamic || f.object.marked_for_destruction? %>
<div class="print_job nested_item" id="<%= id %>" data-price="<%= f.object.price %>" <%= raw 'style="display: none;"' if hide %>>
  <div>
    <% field_classes = ['autocomplete_field'] %>
    <% field_classes << 'field_with_errors' unless f.object.errors[:document_id].blank? %>
    <%= f.input :auto_document_name, label: false, input_html: {
      id: "auto_document_#{id}", class: field_classes.join(' '),
      value: f.object.document.try(:to_s), disabled: disabled,
      'data-autocomplete-url' => autocomplete_for_document_name_prints_path(format: :json) },
      wrapper_html: { class: 'nested_item_field' } %>
    <%= f.input :document_id, as: :hidden, 
      input_html: { class: :autocomplete_id } %>
    <%= f.input :copies, label: false, 
      input_html: { maxlength: 5, class: 'price_modifier page_modifier',
      autocomplete: 'off', disabled: disabled },
      wrapper_html: { class: 'nested_item_field' } %>
    <%= f.input :pages, label: false,
      input_html: { maxlength: 5, class: 'price_modifier page_modifier',
      autocomplete: 'off', disabled: disabled || !f.object.document.blank? },
      wrapper_html: { class: 'nested_item_field' } %>
    <%= f.input :price_per_copy, label: false, 
      input_html: { disabled: true, class: 'price_modifier', 
      autocomplete: 'off' }, wrapper_html: { class: 'nested_item_field' } %>
    <%= f.input :range, label: false,
      input_html: { class: 'price_modifier page_modifier', autocomplete: 'off',
      'data-range-pages' => f.object.range_pages,
      disabled: disabled || (!f.object.new_record? && f.object.document.blank?)},
      wrapper_html: { class: 'nested_item_field' } %>
    <%= f.input :two_sided, as: :boolean, label: false,
      input_html: { class: 'price_modifier', disabled: disabled },
      wrapper_html: { class: 'nested_item_field' }  %>
    
    <div class="nested_item_actions">
      <span class="money"><%= number_to_currency f.object.price %></span>
      <% unless disabled %>
        <%= link_to_remove_nested_item(f) %>
      <% end %>
      <%= link_to_document_details f.object.document %>
      <%= show_document_stock f.object %>
      <%= f.input :lock_version, as: :hidden %>
    </div>
    <div class="dynamic_details" id="<%= "document_details_#{id}" %>"></div>
  </div>
</div>
<% if is_dynamic %>
  <script type="text/javascript">
    Helper.show('#<%= id %>', function() {
      $('<%= "#auto_document_#{id}" %>').focus();
    });
  </script>
<% end %>