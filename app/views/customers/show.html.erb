<h2 class="title"><%= @customer %></h2>

<p>
  <%= mail_to @customer.email %>
</p>

<br />

<p>
  <b><%= Customer.human_attribute_name 'identification' %>:</b>
  <%= @customer.identification %>
</p>

<p>
  <b><%= Customer.human_attribute_name 'free_monthly_bonus' %>:</b>
  <%= number_to_currency(@customer.free_monthly_bonus) %>
</p>

<p>
  <b><%= Customer.human_attribute_name 'bonus_without_expiration' %>:</b>
  <%= t(@customer.bonus_without_expiration ? :yes : :no, scope: :label) %>
</p>

<% unless @customer.current_bonuses.empty? %>
  <section class="nested_items">
    <h2>
      <%= t(
        'view.customers.current_bonuses',
        count: @customer.current_bonuses.size
      ) %>
    </h2>

    <table class="summary">
      <thead>
        <tr>
          <th><%= Bonus.human_attribute_name 'amount' %></th>
          <th><%= Bonus.human_attribute_name 'remaining' %></th>
          <th><%= Bonus.human_attribute_name 'valid_until' %></th>
        </tr>
      </thead>
      <tbody>
        <% @customer.current_bonuses.each do |bonus| %>
          <tr>
            <td><%= number_to_currency bonus.amount %></td>
            <td><%= number_to_currency bonus.remaining %></td>
            <td><%= l bonus.valid_until if bonus.valid_until %></td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </section>
<% end %>

<% unless @customer.current_deposits.empty? %>
  <section class="nested_items">
    <h2>
      <%= t(
        'view.customers.current_deposits',
        count: @customer.current_deposits.size
      ) %>
    </h2>

    <table class="summary">
      <thead>
        <tr>
          <th><%= Deposit.human_attribute_name 'amount' %></th>
          <th><%= Deposit.human_attribute_name 'remaining' %></th>
          <th><%= Deposit.human_attribute_name 'created_at' %></th>
        </tr>
      </thead>
      <tbody>
        <% @customer.current_deposits.each do |deposit| %>
          <tr>
            <td><%= number_to_currency deposit.amount %></td>
            <td><%= number_to_currency deposit.remaining %></td>
            <td><%= l deposit.created_at, format: :minimal if deposit.created_at %></td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </section>
<% end %>

<% amounts = @customer.to_pay_amounts %>
<% if amounts[:total_count] > 0 %>
  <section class="nested_items">
    <h2><%= t('view.customers.to_pay_prints.title') %></h2>

    <table class="summary">
      <thead>
        <tr>
          <th><%= t('view.customers.to_pay_prints.columns.type') %></th>
          <th><%= t('view.customers.to_pay_prints.columns.count') %></th>
          <th><%= t('view.customers.to_pay_prints.columns.unit_price') %></th>
          <th><%= t('view.customers.to_pay_prints.columns.total_price') %></th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><%= t('view.customers.to_pay_prints.rows.one_sided') %></td>
          <td><%= amounts[:one_sided_count] %></td>
          <td><%= number_to_currency amounts[:one_sided_price] %></td>
          <td><%= number_to_currency amounts[:one_sided_count] * amounts[:one_sided_price] %></td>
        </tr>
        <tr>
          <td><%= t('view.customers.to_pay_prints.rows.two_sided') %></td>
          <td><%= amounts[:two_sided_count] %></td>
          <td><%= number_to_currency amounts[:two_sided_price] %></td>
          <td><%= number_to_currency amounts[:two_sided_count] * amounts[:two_sided_price] %></td>
        </tr>
        <tr>
          <td>
            <strong><%= t('view.customers.to_pay_prints.rows.total') %></strong>
          </td>
          <td><strong><%= amounts[:total_count] %></strong></td>
          <td></td>
          <td><strong><%= show_total_to_pay_amount amounts %></strong></td>
        </tr>
      </tbody>
    </table>
  </section>
<% else %>
  <br />
  <p>
    <strong><%= t('view.customers.to_pay_prints.no_debt') %></strong>
  </p>
<% end %>

<nav class="links">
  <%= link_to t('label.edit'), edit_customer_path(@customer) %> |
  <%= show_link_to_customer_prints(@customer) %> |
  <%= show_link_to_customer_bonuses(@customer) %> |
  <%= show_link_to_customer_non_payments(@customer) %> |
  <%= link_to t('label.list'), customers_path %>
</nav>